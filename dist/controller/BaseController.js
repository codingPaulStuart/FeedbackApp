sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","feedbackapp/feedbackapp/model/models","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","feedbackapp/feedbackapp/utils/FeedbackAppUtilityFile"],function(e,t,o,s,r,i,a,n){"use strict";return e.extend("feedbackapp.feedbackapp.controller.BaseController",{onBack:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);this.getView().getModel("SettingsModel").setProperty("/EmployeeSelected",false);e.navTo("Main")},onDialogButtonsCreateItems:function(e,t){var o=this.getView().getModel("FeedbackModel");var s=this.getView().getModel("PDPlanModel");var r=this.getView().getModel("SettingsModel");var i=r.getProperty("/ReviewsListSelectedKey");var l=s.getProperty("/CurrentPDPlan");var d;var c,p,g;if(r.getProperty("/IsEditingGoal")===false&&t==="CREATE"){if(i==="Feedback"||i==="Reviews"){d=o.getProperty("/NewReview")}else if(i==="PDdevItems"||i==="Action"){d=s.getProperty("/NewItem");d.PDplanID=l.PDplanID;if(i==="Action"){i="Goals"}}else if(t==="CANCEL"){o.setProperty("/NewReview","");s.setProperty("/NewItem","");r.setProperty("/IsEditingGoal",false);if(i==="Action"){this.getView().getModel("SettingsModel").setProperty("/ReviewsListSelectedKey","PDdevItems")}this.byId("createNewEntryDialog").close()}var P=this;console.log(i);this.getView().getModel("oDataFeedback").create("/"+i,d,{success:function(e,t){console.log("Success! createNewEntry");a.show("Successfully Created!");P.getView().getModel("oDataFeedback").read("/"+i,{success:function(e,t){var s=e.results;if(i==="Feedback"||i==="Reviews"){o.setProperty("/ReviewList",s);console.log(o.getProperty("/ReviewList"));console.log("successful read")}else{P.getPDPlanFromBackend("ShowAll","/DevelopmentItemsList","PDplans(PDplanID="+l.PDplanID+")","to_DevItem/to_goals,to_DevItem/to_notes")}},error:function(e,t){a.show("Error: Reading Dev Items")}})},error:function(e){a.show("Error! createNewEntry")}})}else if(r.getProperty("/IsEditingGoal")===true){if(t==="CANCEL"){o.setProperty("/NewReview","");r.setProperty("/IsEditingGoal",false);this.loadFromBackend("/DevelopmentItemsList",s,"PDdevItems");this.byId("createNewEntryDialog").close();a.show("Update Cancelled")}else if(i==="PDdevItems"){d=s.getProperty("/NewItem");c="PDdevItems";p="DevItemID";g=d.DevItemID}else if(i==="Action"){d=s.getProperty("/NewItem");c="Goals";p="GoalSettingID";g=d.GoalSettingID}n.updateEntitySet(this,c,p,g,d);r.setProperty("/IsEditingGoal",false)}this.byId("createNewEntryDialog").close()},onReviewAssignment:function(e){n.createNewEntryAndDialog(e,this)},managePopOver:function(e,t){var o=e.getSource(),r=this.getView();if(!this._pPopover){this._pPopover=s.load({id:r.getId(),name:t,controller:this}).then(function(e){r.addDependent(e);return e})}this._pPopover.then(function(e){e.openBy(o)})},loadFromBackend:function(e,t,o){var s=[];var a=this.getView().getModel("SettingsModel").getProperty("/MasterSearchQuery");if(a&&a.length>0){s.push(new r({filters:[new r("EmployeeName",i.Contains,a),new r("ReviewerName",i.Contains,a)],and:false}))}this.getView().getModel("oDataFeedback").read("/"+o,{filters:s,success:function(s,r){var i=s.results;if(o==="IndividualReviews"){o="Reviews"}t.setProperty("/"+o,i);if(e==="/ReviewList"){t.setProperty(e,i)}}})},getPDPlanFromBackend:function(e,t,o,s){var r=this.getView().getModel("PDPlanModel");var i=[];var a;var n;var l=[];if(s!==null){this.getView().getModel("oDataFeedback").read("/"+o,{filters:i,urlParameters:{$expand:s},success:function(e,o){if(e.results===undefined){var s=e}else{var s=e.results}if(t!=="/CurrentPDPlan"){r.setProperty(t,s.to_DevItem.results)}else{r.setProperty(t,s);console.log("PD plan loaded");console.log(r)}n=r.getProperty("/DevelopmentItemsList");for(var i=0;i<n.length;i++){for(var a=0;a<n[i].to_notes.results.length;a++){l.push(n[i].to_notes.results[a])}}r.setProperty("/NotesList",l)}})}else{this.getView().getModel("oDataFeedback").read("/"+o,{success:function(e,o){var s=e.results;r.setProperty(t,s)}})}},onselectPDplanListItem:function(e){var t=e.getSource().getBindingContext("PDPlanModel").getObject();this.getPDPlanFromBackend("FilterOutArchived","/CurrentPDPlan","PDplans(PDplanID="+t.PDplanID+")","to_DevItem");this.getPDPlanFromBackend("FilterOutArchived","/DevelopmentItemsList","PDplans(PDplanID="+t.PDplanID+")","to_DevItem/to_goals,to_DevItem/to_notes");this.getView().getModel("SettingsModel").setProperty("/UpdatePDplan",true)},switchMode:function(){var e=this.getView().getModel("SettingsModel");var t=e.getProperty("/UserRole");var o="";if(t==="Admin"){o="User"}else{o="Admin"}e.setProperty("/UserRole",o)},accessPDPlan:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("PDPlanDetails")}})});