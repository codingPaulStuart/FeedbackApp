sap.ui.define(["feedbackapp/feedbackapp/controller/BaseController","sap/ui/model/json/JSONModel","feedbackapp/feedbackapp/model/models","sap/m/MessageToast","sap/m/library","sap/m/GenericTile","sap/ui/core/Fragment","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/data/FlattenedDataset","feedbackapp/feedbackapp/utils/FeedbackAppUtilityFile","sap/ui/core/format/DateFormat"],function(e,t,o,i,a,r,s,l,n,d,c,p,g){"use strict";var u=a.URLHelper;return e.extend("feedbackapp.feedbackapp.controller.ReviewDetail",{onAfterRendering:function(){this._oRouter=sap.ui.core.UIComponent.getRouterFor(this);this._oRouter.getRoute("ReviewDetail").attachMatched(this.handleRouteMatched,this);var e=this.getView().getModel("FeedbackModel").getProperty("/ReviewDetails");if(e===undefined||e===null||e.length===0){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("Main")}},handleRouteMatched:function(e){var t=this.getView().getModel("FeedbackModel").getProperty("/ReviewDetails");var i=this.getView().getModel("SettingsModel").getProperty("/ReviewsListSelectedKey");if(i==="Feedback"){this.feedbackValueComparison(t);this.setVizFrameRadar();this.getView().getModel("FeedbackModel").setProperty("/NewGoal",o.createGoalTemplate())}},feedbackValueComparison:function(e){var t=this.getView().getModel("SettingsModel").getProperty("/ReviewsListSelectedKey");var o=this.getView().getModel("FeedbackModel");var i=o.getProperty("/Feedback");if(t==="Feedback"){var a=i.findIndex(t=>t.EmployeeName===e.EmployeeName);var a=a-1;for(var r=a;r>=0;r--){if(i[r].EmployeeName===e.EmployeeName){o.setProperty("/PreviousFeedbackSummary",i[r])}}}},setVizFrameRadar:function(){var e=this.byId("viz");d.createDataSets(e,this);d.updateMeasures(this);d.setChart(e,this);d.setFeeds(e,this)},onTilePress:function(e){var t=e.getSource().getHeader();var o=this.getView().getModel("SettingsModel").getProperty("/ReviewsListSelectedKey");var i=this.getView().getModel("SettingsModel");var a=this.getView().getModel("FeedbackModel");var r=[];if(o==="Feedback"){if(t==="Business Knowledge"){t="BusinessKnowledge"}else if(t==="Stakeholder Management"){t="StakeholderMGMT"}else if(t==="User Requirements"){t="UserRequirements"}else if(t==="Solution Design"){t="SolutionDesign"}else if(t==="Technical Skills"){t="TechnicalSkills"}}console.log(a.getProperty("/ReviewStorage"));for(var s=0;s<a.getProperty("/ReviewStorage").length;s++){r.push(a.getProperty("/ReviewStorage/"+s+"/"+t));if(s===a.getProperty("/ReviewStorage").length-1||a.getProperty("/ReviewStorage").length===0){if(t==="BusinessKnowledge"){t="Business Knowledge"}else if(t==="StakeholderMGMT"){t="Stakeholder Management"}else if(t==="UserRequirements"){t="User Requirements"}else if(t==="SolutionDesign"){t="Solution Design"}else if(t==="TechnicalSkills"){t="Technical Skills"}}}i.setProperty("/TileName",t);console.log(i.getProperty("/TileName"));i.setProperty("/TileArray",r);this.managePopOver(e,"feedbackapp.feedbackapp.view.fragments.PopoverForGraphDisplay")},onReviewOptions:function(e){var t=this.getView().getModel("FeedbackModel");var o=this.getView().getModel("SettingsModel");var a=o.getProperty("/UserRole");var r=e.getSource().getText();var s=t.getProperty("/ReviewDetails");var l=sap.ui.core.UIComponent.getRouterFor(this);if(r==="Approve Feedback"||r==="Accept Feedback"){if(a==="Admin"){t.setProperty("/ReviewDetails/DateSubmitted",c.getDateInstance({pattern:"yyyyMMdd"}).format(new Date))}else{i.show("Feedback Accepted")}s.ReviewState="Completed";s.ReviewerName="Admin";var n=d.stringifyScores(this,s);i.show(n);this.getView().getModel("oDataFeedback").update("/Feedback(FeedbackID="+s.FeedbackID+")",n,{success:function(e,t){i.show("Success, Feedback updated!");i.show("Feedback Updated!")},error:function(e){i.show("Error, Feedback could not be updated!")}})}else if(r==="Submit Review"){d.reviewStateChange(this,"Completed")}else if(r==="Dispute Review"){d.reviewStateChange(this,"Disputed")}else if(r==="Set back to Pending"){d.reviewStateChange(this,"Pending")}},onSelectEmployeeRole:function(e){var t=this.getView().getModel("FeedbackModel");t.setProperty("/ReviewDetails/RoleName",e.getParameters().value)},resetRoleDef:function(){var e=this.getView().getModel("FeedbackModel");var t=e.getProperty("/RoleDefaults/RoleIntuition");e.setProperty("/ReviewDetails/RoleIntuition",t);var o=e.getProperty("/RoleDefaults/RoleDocumentation");e.setProperty("/ReviewDetails/RoleDocumentation",o);var i=e.getProperty("/RoleDefaults/RoleCommunication");e.setProperty("/ReviewDetails/RoleCommunication",i);var a=e.getProperty("/RoleDefaults/RoleBusinessKnowledge");e.setProperty("/ReviewDetails/RoleBusinessKnowledge",a);var r=e.getProperty("/RoleDefaults/RoleStakeholderMGMT");e.setProperty("/ReviewDetails/RoleStakeholderMGMT",r);var s=e.getProperty("/RoleDefaults/RoleUserRequirements");e.setProperty("/ReviewDetails/RoleUserRequirements",s);var l=e.getProperty("/RoleDefaults/RoleFacilitation");e.setProperty("/ReviewDetails/RoleFacilitation",l);var n=e.getProperty("/RoleDefaults/RoleSolutionDesign");e.setProperty("/ReviewDetails/RoleSolutionDesign",n);var d=e.getProperty("/RoleDefaults/RoleVisibility");e.setProperty("/ReviewDetails/RoleVisibility",d);var c=e.getProperty("/RoleDefaults/RoleTechnicalSkills");e.setProperty("/ReviewDetails/RoleTechnicalSkills",c)},onRoleSave:function(e){var t=this.getView().getModel("FeedbackModel");var o=t.getProperty("/ReviewDetails");o=d.stringifyScores(this,o);this.getView().getModel("oDataFeedback").update("/Feedback(FeedbackID="+o.FeedbackID+")",o,{success:function(e,t){i.show("Job Role Description and Title updated")},error:function(e){i.show("job Role and Description could not be updated, error occurred")},refreshAfterChange:true})}})});