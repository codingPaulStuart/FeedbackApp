sap.ui.define(["feedbackapp/feedbackapp/controller/BaseController","sap/ui/model/json/JSONModel","feedbackapp/feedbackapp/model/models","sap/m/MessageToast","feedbackapp/feedbackapp/utils/FeedbackAppUtilityFile","sap/ui/core/format/DateFormat"],function(e,t,o,a,n,r){"use strict";return e.extend("feedbackapp.feedbackapp.controller.PDPlanDetails",{onAfterRendering:function(){this._oRouter=sap.ui.core.UIComponent.getRouterFor(this);this._oRouter.getRoute("PDPlanDetails").attachMatched(this.handleRouteMatched,this)},handleRouteMatched:function(e){var t=this.getView().getModel("SettingsModel");var o=t.getProperty("/ReviewsListSelectedKey");var a=this.getView().getModel("PDPlanModel");if(o==="PDplans"){t.setProperty("/EmployeeSelected",true)}},onCheckBoxSelected:function(e,t){var o=this.getView().getModel("PDPlanModel");var a=o.getProperty("/CurrentPDPlan");var n=e.getParameter("selected");if(n===true){if(t==="MANAGER"){a.ManagerAcceptDate=r.getDateInstance({pattern:"yyyyMMdd"}).format(new Date);a.ManagerAccept=String(n)}else if(t==="EMPLOYEE"){a.EmployeeAccept=String(n);a.EmployeeAcceptDate=r.getDateInstance({pattern:"yyyyMMdd"}).format(new Date)}}else{if(t==="MANAGER"){a.ManagerAcceptDate="";a.ManagerAccept=String(n)}else if(t==="EMPLOYEE"){a.EmployeeAcceptDate="";a.EmployeeAccept=String(n)}}},onCreatePDPlan:function(e,t){var a=this.getView().getModel("SettingsModel");var r=o.createPDPlanTemplate();var i=this.getView().getModel("EmployeeNamesModel").getProperty("/Employee");i.sort(n.alphabeticalCompare);r.EmployeeName=a.getProperty("/EmployeeName");r.ManagerName=i[0].Displayname;var l=this;this.getView().getModel("oDataFeedback").create("/PDplans",r,{success:function(e,t){console.log("Performance Development Plan Created");l.getPDPlanFromBackend("FilterOutArchived","/PDplansList","PDplans",null)},error:function(e){console.log("Error Creating PD Plan")},refreshAfterChange:true});a.setProperty("/UpdatePDplan",false)},onGoalCreate:function(){var e=this.getView().getModel("PDPlanModel");var t=e.getProperty("/DevelopmentItemsList");var a=o.createDevItemTemplate();t.push(a);e.setProperty("/DevelopmentItemsList",t)},onCreateDevItem:function(e,t){var o=this.getView().getModel("SettingsModel");var a=e.getSource().getBindingContext("PDPlanModel").getObject();o.setProperty("/ReviewsListSelectedKey",t);n.createNewEntryAndDialog(e,this)},onPDplanDecision:function(e){var t=this.getView().getModel("PDPlanModel").getProperty("/CurrentPDPlan");var o=this.getView().getModel("SettingsModel").getProperty("/UpdatePDplan");t.LastReviewDate=r.getDateInstance({pattern:"yyyyMMdd"}).format(new Date);if(o===true){if(t.EmployeeAccept==="true"&&t.ManagerAccept==="true"){t.Status="Completed"}else{t.Status="Pending"}n.updateEntitySet(this,"PDplans","PDplanID",t.PDplanID,t)}else if(o===false){console.log(t);this.getView().getModel("oDataFeedback").create("/PDplans",t,{success:function(e,t){console.log("Performance Development Plan Created")},error:function(e){console.log("Error Creating PD Plan")},refreshAfterChange:true})}},onDevItemOptions:function(e,t){var o=this.getView().getModel("PDPlanModel");var a=e.getSource().getBindingContext("PDPlanModel").getObject();var r=this.getView().getModel("SettingsModel");if(t==="COMPLETE"&&a.Status==="Pending"||t==="ARCHIVE"){if(t==="COMPLETE"){a.Status="Completed"}else if(t==="ARCHIVE"){a.Status="Archived"}n.updateEntitySet(this,"PDdevItems","DevItemID",a.DevItemID,a)}else if(t==="EDIT_DEVITEM"||t==="EDIT_ACTIONITEM"){if(t==="EDIT_DEVITEM"){r.setProperty("/ReviewsListSelectedKey","PDdevItems")}else if(t==="EDIT_ACTIONITEM"){r.setProperty("/ReviewsListSelectedKey","Action")}o.setProperty("/NewItem",a);r.setProperty("/ReviewsListSelectedKey","PDdevItems");r.setProperty("/IsEditingGoal",true);if(!this.pDialog){this.pDialog=this.loadFragment({name:"feedbackapp.feedbackapp.view.fragments.CreateNewEntry"})}this.pDialog.then(function(e){e.open()})}},onShowGoals:function(e,t){var o=e.getSource().getPressed();var a=this.getView().getModel("PDPlanModel").getProperty("/CurrentPDPlan");if(o===true){}else if(o===false){}},onNotePost:function(e){var t=this.getView();var a=this.getView().getModel("PDPlanModel");var n=e.getSource().getBindingContext("PDPlanModel").getObject();var r=a.getProperty("/CurrentPDPlan");var i=o.createNoteTemplate();i.PDplanID=n.PDplanID;i.DevItemID=n.DevItemID;i.EmployeeID=r.EmployeeID;a.setProperty("/ChooseActionList",n.to_goals.results);a.setProperty("/NewNote",i);if(!this.newNoteDialog){this.newNoteDialog=sap.ui.xmlfragment("feedbackapp.feedbackapp.view.fragments.NoteDialog",this);t.addDependent(this.newNoteDialog);this.newNoteDialog.open()}this.newNoteDialog.open()},onSaveNote:function(e){n.createNote(this);this.newNoteDialog.close()},onNoteDialogCancel:function(){console.log("Note Creation Cancelled by User");this.newNoteDialog.close()},onActionChosen:function(e){var t=this.getView().getModel("PDPlanModel");var o=t.getProperty("/NewNote");var a=e.getSource().getBindingContext("PDPlanModel").getObject();var n=this.getView().getModel("PDPlanModel").getProperty("/ChooseActionList");var r=n.find(e=>e.GoalSettingID==a.GoalSettingID);o.ActionItem=r.ActionItemName;console.log(o)}})});